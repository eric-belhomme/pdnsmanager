<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('title') }}{% endblock %}</title>
    <link rel="icon" href="https://www.powerdns.com/favicon.ico">
    <script src="/static/js/tailwindcss.js"></script>
    <link rel="stylesheet" href="/static/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script>
        // Theme initialization
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }

        function setTheme(theme) {
            if (theme === 'system') {
                localStorage.removeItem('theme')
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } else {
                localStorage.theme = theme
                document.documentElement.classList.toggle('dark', theme === 'dark');
            }
        }

        function setLanguage(lang) {
            document.cookie = `pdns_lang=${lang}; path=/; max-age=31536000`;
            window.location.reload();
        }
    </script>
    {% block scripts %}{% endblock %}
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 font-sans transition-colors duration-200">

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Header & Navigation -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                {% block header_left %}{% endblock %}
            </div>
            <div class="flex items-center gap-4">
                {% block header_right_extras %}{% endblock %}
                
                <!-- Language Selector -->
                <select onchange="setLanguage(this.value)" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-1 px-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="en" {% if lang == 'en' %}selected{% endif %}>ðŸ‡¬ðŸ‡§ EN</option>
                    <option value="fr" {% if lang == 'fr' %}selected{% endif %}>ðŸ‡«ðŸ‡· FR</option>
                </select>

                <!-- Theme Selector -->
                <select onchange="setTheme(this.value)" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-1 px-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="light">{{ _('light') }}</option>
                    <option value="dark">{{ _('dark') }}</option>
                    <option value="system">{{ _('system') }}</option>
                </select>
                <script>
                    // Set initial value for theme selector
                    document.querySelector('select[onchange^="setTheme"]').value = localStorage.theme || 'system';
                </script>

                <!-- User Identity -->
                {% if user %}
                <a href="/profile" class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors" title="{{ user.username }}">{{ user.name }}</a>
                {% endif %}

                <!-- Admin page -->
                {% if "admins" in user.groups %}
                <a href="/admin" class="bg-amber-500 hover:bg-amber-600 text-white py-1 px-3 rounded text-sm flex items-center" title="{{ _('admin') }}">
                    <i class="fas fa-user-shield"></i>
                </a>
                {% endif %}

                <!-- Logout -->
                <a href="/logout" class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-sm flex items-center" title="{{ _('logout') }}">
                    <i class="fa-solid fa-sign-out-alt"></i>
                </a>
            </div>
        </div>

        {% block content %}{% endblock %}
    </div>
</body>
</html>